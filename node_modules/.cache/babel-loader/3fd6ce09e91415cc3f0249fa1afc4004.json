{"remainingRequest":"F:\\ServerPlatformWeb\\node_modules\\babel-loader\\lib\\index.js!F:\\ServerPlatformWeb\\node_modules\\eslint-loader\\index.js??ref--14-0!F:\\ServerPlatformWeb\\src\\router\\guards.js","dependencies":[{"path":"F:\\ServerPlatformWeb\\src\\router\\guards.js","mtime":1651512164138},{"path":"F:\\ServerPlatformWeb\\babel.config.js","mtime":1651512117562},{"path":"F:\\ServerPlatformWeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1651512135878},{"path":"F:\\ServerPlatformWeb\\node_modules\\babel-loader\\lib\\index.js","mtime":1651512132831},{"path":"F:\\ServerPlatformWeb\\node_modules\\eslint-loader\\index.js","mtime":1651512148396}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCB7IGhhc0F1dGhvcml0eSB9IGZyb20gJ0AvdXRpbHMvYXV0aG9yaXR5LXV0aWxzJzsKaW1wb3J0IHsgbG9naW5JZ25vcmUgfSBmcm9tICdAL3JvdXRlci9pbmRleCc7CmltcG9ydCB7IGNoZWNrQXV0aG9yaXphdGlvbiB9IGZyb20gJ0AvdXRpbHMvcmVxdWVzdCc7CmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwovKioNCiAqIOi/m+W6puadoeW8gOWniw0KICogQHBhcmFtIHRvDQogKiBAcGFyYW0gZm9ybQ0KICogQHBhcmFtIG5leHQNCiAqLwoKdmFyIHByb2dyZXNzU3RhcnQgPSBmdW5jdGlvbiBwcm9ncmVzc1N0YXJ0KHRvLCBmcm9tLCBuZXh0KSB7CiAgLy8gc3RhcnQgcHJvZ3Jlc3MgYmFyCiAgaWYgKCFOUHJvZ3Jlc3MuaXNTdGFydGVkKCkpIHsKICAgIE5Qcm9ncmVzcy5zdGFydCgpOwogIH0KCiAgbmV4dCgpOwp9OwovKioNCiAqIOeZu+W9leWuiOWNqw0KICogQHBhcmFtIHRvDQogKiBAcGFyYW0gZm9ybQ0KICogQHBhcmFtIG5leHQNCiAqIEBwYXJhbSBvcHRpb25zDQogKi8KCgp2YXIgbG9naW5HdWFyZCA9IGZ1bmN0aW9uIGxvZ2luR3VhcmQodG8sIGZyb20sIG5leHQsIG9wdGlvbnMpIHsKICB2YXIgbWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZTsKCiAgaWYgKCFsb2dpbklnbm9yZS5pbmNsdWRlcyh0bykgJiYgIWNoZWNrQXV0aG9yaXphdGlvbigpKSB7CiAgICBtZXNzYWdlLndhcm5pbmcoJ+eZu+W9leW3suWkseaViO+8jOivt+mHjeaWsOeZu+W9lScpOwogICAgbmV4dCh7CiAgICAgIHBhdGg6ICcvbG9naW4nCiAgICB9KTsKICB9IGVsc2UgewogICAgbmV4dCgpOwogIH0KfTsKLyoqDQogKiDmnYPpmZDlrojljasNCiAqIEBwYXJhbSB0bw0KICogQHBhcmFtIGZvcm0NCiAqIEBwYXJhbSBuZXh0DQogKiBAcGFyYW0gb3B0aW9ucw0KICovCgoKdmFyIGF1dGhvcml0eUd1YXJkID0gZnVuY3Rpb24gYXV0aG9yaXR5R3VhcmQodG8sIGZyb20sIG5leHQsIG9wdGlvbnMpIHsKICB2YXIgc3RvcmUgPSBvcHRpb25zLnN0b3JlLAogICAgICBtZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlOwogIHZhciBwZXJtaXNzaW9ucyA9IHN0b3JlLmdldHRlcnNbJ2FjY291bnQvcGVybWlzc2lvbnMnXTsKICB2YXIgcm9sZXMgPSBzdG9yZS5nZXR0ZXJzWydhY2NvdW50L3JvbGVzJ107CgogIGlmICghaGFzQXV0aG9yaXR5KHRvLCBwZXJtaXNzaW9ucywgcm9sZXMpKSB7CiAgICBtZXNzYWdlLndhcm5pbmcoIlx1NUJGOVx1NEUwRFx1OEQ3N1x1RkYwQ1x1NjBBOFx1NjVFMFx1Njc0M1x1OEJCRlx1OTVFRVx1OTg3NVx1OTc2MjogIi5jb25jYXQodG8uZnVsbFBhdGgsICJcdUZGMENcdThCRjdcdTgwNTRcdTdDRkJcdTdCQTFcdTc0MDZcdTU0NTgiKSk7CiAgICBuZXh0KHsKICAgICAgcGF0aDogJy80MDMnCiAgICB9KTsgLy8gTlByb2dyZXNzLmRvbmUoKQogIH0gZWxzZSB7CiAgICBuZXh0KCk7CiAgfQp9OwovKioNCiAqIOa3t+WQiOWvvOiIquaooeW8j+S4i+S4gOe6p+iPnOWNlei3s+i9rOmHjeWumuWQkQ0KICogQHBhcmFtIHRvDQogKiBAcGFyYW0gZnJvbQ0KICogQHBhcmFtIG5leHQNCiAqIEBwYXJhbSBvcHRpb25zDQogKiBAcmV0dXJucyB7Kn0NCiAqLwoKCnZhciByZWRpcmVjdEd1YXJkID0gZnVuY3Rpb24gcmVkaXJlY3RHdWFyZCh0bywgZnJvbSwgbmV4dCwgb3B0aW9ucykgewogIHZhciBzdG9yZSA9IG9wdGlvbnMuc3RvcmU7CgogIHZhciBnZXRGaXJzdENoaWxkID0gZnVuY3Rpb24gZ2V0Rmlyc3RDaGlsZChyb3V0ZXMpIHsKICAgIHZhciByb3V0ZSA9IHJvdXRlc1swXTsKCiAgICBpZiAoIXJvdXRlLmNoaWxkcmVuIHx8IHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gcm91dGU7CiAgICB9CgogICAgcmV0dXJuIGdldEZpcnN0Q2hpbGQocm91dGUuY2hpbGRyZW4pOwogIH07CgogIGlmIChzdG9yZS5zdGF0ZS5zZXR0aW5nLmxheW91dCA9PT0gJ21peCcpIHsKICAgIHZhciBmaXJzdE1lbnUgPSBzdG9yZS5nZXR0ZXJzWydzZXR0aW5nL2ZpcnN0TWVudSddOwoKICAgIGlmIChmaXJzdE1lbnUuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICByZXR1cm4gaXRlbS5mdWxsUGF0aCA9PT0gdG8uZnVsbFBhdGg7CiAgICB9KSkgewogICAgICBzdG9yZS5jb21taXQoJ3NldHRpbmcvc2V0QWN0aXZhdGVkRmlyc3QnLCB0by5mdWxsUGF0aCk7CiAgICAgIHZhciBzdWJNZW51ID0gc3RvcmUuZ2V0dGVyc1snc2V0dGluZy9zdWJNZW51J107CgogICAgICBpZiAoc3ViTWVudS5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHJlZGlyZWN0ID0gZ2V0Rmlyc3RDaGlsZChzdWJNZW51KTsKICAgICAgICByZXR1cm4gbmV4dCh7CiAgICAgICAgICBwYXRoOiByZWRpcmVjdC5mdWxsUGF0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQoKICBuZXh0KCk7Cn07Ci8qKg0KICog6L+b5bqm5p2h57uT5p2fDQogKiBAcGFyYW0gdG8NCiAqIEBwYXJhbSBmb3JtDQogKiBAcGFyYW0gb3B0aW9ucw0KICovCgoKdmFyIHByb2dyZXNzRG9uZSA9IGZ1bmN0aW9uIHByb2dyZXNzRG9uZSgpIHsKICAvLyBmaW5pc2ggcHJvZ3Jlc3MgYmFyCiAgTlByb2dyZXNzLmRvbmUoKTsKfTsKCmV4cG9ydCBkZWZhdWx0IHsKICBiZWZvcmVFYWNoOiBbcHJvZ3Jlc3NTdGFydCwgbG9naW5HdWFyZCwgYXV0aG9yaXR5R3VhcmQsIHJlZGlyZWN0R3VhcmRdLAogIGFmdGVyRWFjaDogW3Byb2dyZXNzRG9uZV0KfTs="},{"version":3,"sources":["F:/ServerPlatformWeb/src/router/guards.js"],"names":["hasAuthority","loginIgnore","checkAuthorization","NProgress","configure","showSpinner","progressStart","to","from","next","isStarted","start","loginGuard","options","message","includes","warning","path","authorityGuard","store","permissions","getters","roles","fullPath","redirectGuard","getFirstChild","routes","route","children","length","state","setting","layout","firstMenu","find","item","commit","subMenu","redirect","progressDone","done","beforeEach","afterEach"],"mappings":";;;;AAAA,SAAQA,YAAR,QAA2B,yBAA3B;AACA,SAAQC,WAAR,QAA0B,gBAA1B;AACA,SAAQC,kBAAR,QAAiC,iBAAjC;AACA,OAAOC,SAAP,MAAsB,WAAtB;AAEAA,SAAS,CAACC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACxC;AACA,MAAI,CAACN,SAAS,CAACO,SAAV,EAAL,EAA4B;AAC1BP,IAAAA,SAAS,CAACQ,KAAV;AACD;;AACDF,EAAAA,IAAI;AACL,CAND;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMG,UAAU,GAAG,SAAbA,UAAa,CAACL,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AAC9C,MAAOC,OAAP,GAAkBD,OAAlB,CAAOC,OAAP;;AACA,MAAI,CAACb,WAAW,CAACc,QAAZ,CAAqBR,EAArB,CAAD,IAA6B,CAACL,kBAAkB,EAApD,EAAwD;AACtDY,IAAAA,OAAO,CAACE,OAAR,CAAgB,aAAhB;AACAP,IAAAA,IAAI,CAAC;AAACQ,MAAAA,IAAI,EAAE;AAAP,KAAD,CAAJ;AACD,GAHD,MAGO;AACLR,IAAAA,IAAI;AACL;AACF,CARD;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMS,cAAc,GAAG,SAAjBA,cAAiB,CAACX,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AAClD,MAAOM,KAAP,GAAyBN,OAAzB,CAAOM,KAAP;AAAA,MAAcL,OAAd,GAAyBD,OAAzB,CAAcC,OAAd;AACA,MAAMM,WAAW,GAAGD,KAAK,CAACE,OAAN,CAAc,qBAAd,CAApB;AACA,MAAMC,KAAK,GAAGH,KAAK,CAACE,OAAN,CAAc,eAAd,CAAd;;AACA,MAAI,CAACrB,YAAY,CAACO,EAAD,EAAKa,WAAL,EAAkBE,KAAlB,CAAjB,EAA2C;AACzCR,IAAAA,OAAO,CAACE,OAAR,+EAAgCT,EAAE,CAACgB,QAAnC;AACAd,IAAAA,IAAI,CAAC;AAACQ,MAAAA,IAAI,EAAE;AAAP,KAAD,CAAJ,CAFyC,CAGzC;AACD,GAJD,MAIO;AACLR,IAAAA,IAAI;AACL;AACF,CAXD;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMe,aAAa,GAAG,SAAhBA,aAAgB,CAACjB,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AACjD,MAAOM,KAAP,GAAgBN,OAAhB,CAAOM,KAAP;;AACA,MAAMM,aAAa,GAAG,SAAhBA,aAAgB,CAACC,MAAD,EAAY;AAChC,QAAMC,KAAK,GAAGD,MAAM,CAAC,CAAD,CAApB;;AACA,QAAI,CAACC,KAAK,CAACC,QAAP,IAAmBD,KAAK,CAACC,QAAN,CAAeC,MAAf,KAA0B,CAAjD,EAAoD;AAClD,aAAOF,KAAP;AACD;;AACD,WAAOF,aAAa,CAACE,KAAK,CAACC,QAAP,CAApB;AACD,GAND;;AAOA,MAAIT,KAAK,CAACW,KAAN,CAAYC,OAAZ,CAAoBC,MAApB,KAA+B,KAAnC,EAA0C;AACxC,QAAMC,SAAS,GAAGd,KAAK,CAACE,OAAN,CAAc,mBAAd,CAAlB;;AACA,QAAIY,SAAS,CAACC,IAAV,CAAe,UAAAC,IAAI;AAAA,aAAIA,IAAI,CAACZ,QAAL,KAAkBhB,EAAE,CAACgB,QAAzB;AAAA,KAAnB,CAAJ,EAA2D;AACzDJ,MAAAA,KAAK,CAACiB,MAAN,CAAa,2BAAb,EAA0C7B,EAAE,CAACgB,QAA7C;AACA,UAAMc,OAAO,GAAGlB,KAAK,CAACE,OAAN,CAAc,iBAAd,CAAhB;;AACA,UAAIgB,OAAO,CAACR,MAAR,GAAiB,CAArB,EAAwB;AACtB,YAAMS,QAAQ,GAAGb,aAAa,CAACY,OAAD,CAA9B;AACA,eAAO5B,IAAI,CAAC;AAACQ,UAAAA,IAAI,EAAEqB,QAAQ,CAACf;AAAhB,SAAD,CAAX;AACD;AACF;AACF;;AACDd,EAAAA,IAAI;AACL,CArBD;AAuBA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAM8B,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB;AACApC,EAAAA,SAAS,CAACqC,IAAV;AACD,CAHD;;AAKA,eAAe;AACbC,EAAAA,UAAU,EAAE,CAACnC,aAAD,EAAgBM,UAAhB,EAA4BM,cAA5B,EAA4CM,aAA5C,CADC;AAEbkB,EAAAA,SAAS,EAAE,CAACH,YAAD;AAFE,CAAf","sourcesContent":["import {hasAuthority} from '@/utils/authority-utils'\r\nimport {loginIgnore} from '@/router/index'\r\nimport {checkAuthorization} from '@/utils/request'\r\nimport NProgress from 'nprogress'\r\n\r\nNProgress.configure({ showSpinner: false })\r\n\r\n/**\r\n * 进度条开始\r\n * @param to\r\n * @param form\r\n * @param next\r\n */\r\nconst progressStart = (to, from, next) => {\r\n  // start progress bar\r\n  if (!NProgress.isStarted()) {\r\n    NProgress.start()\r\n  }\r\n  next()\r\n}\r\n\r\n/**\r\n * 登录守卫\r\n * @param to\r\n * @param form\r\n * @param next\r\n * @param options\r\n */\r\nconst loginGuard = (to, from, next, options) => {\r\n  const {message} = options\r\n  if (!loginIgnore.includes(to) && !checkAuthorization()) {\r\n    message.warning('登录已失效，请重新登录')\r\n    next({path: '/login'})\r\n  } else {\r\n    next()\r\n  }\r\n}\r\n\r\n/**\r\n * 权限守卫\r\n * @param to\r\n * @param form\r\n * @param next\r\n * @param options\r\n */\r\nconst authorityGuard = (to, from, next, options) => {\r\n  const {store, message} = options\r\n  const permissions = store.getters['account/permissions']\r\n  const roles = store.getters['account/roles']\r\n  if (!hasAuthority(to, permissions, roles)) {\r\n    message.warning(`对不起，您无权访问页面: ${to.fullPath}，请联系管理员`)\r\n    next({path: '/403'})\r\n    // NProgress.done()\r\n  } else {\r\n    next()\r\n  }\r\n}\r\n\r\n/**\r\n * 混合导航模式下一级菜单跳转重定向\r\n * @param to\r\n * @param from\r\n * @param next\r\n * @param options\r\n * @returns {*}\r\n */\r\nconst redirectGuard = (to, from, next, options) => {\r\n  const {store} = options\r\n  const getFirstChild = (routes) => {\r\n    const route = routes[0]\r\n    if (!route.children || route.children.length === 0) {\r\n      return route\r\n    }\r\n    return getFirstChild(route.children)\r\n  }\r\n  if (store.state.setting.layout === 'mix') {\r\n    const firstMenu = store.getters['setting/firstMenu']\r\n    if (firstMenu.find(item => item.fullPath === to.fullPath)) {\r\n      store.commit('setting/setActivatedFirst', to.fullPath)\r\n      const subMenu = store.getters['setting/subMenu']\r\n      if (subMenu.length > 0) {\r\n        const redirect = getFirstChild(subMenu)\r\n        return next({path: redirect.fullPath})\r\n      }\r\n    }\r\n  }\r\n  next()\r\n}\r\n\r\n/**\r\n * 进度条结束\r\n * @param to\r\n * @param form\r\n * @param options\r\n */\r\nconst progressDone = () => {\r\n  // finish progress bar\r\n  NProgress.done()\r\n}\r\n\r\nexport default {\r\n  beforeEach: [progressStart, loginGuard, authorityGuard, redirectGuard],\r\n  afterEach: [progressDone]\r\n}\r\n"]}]}